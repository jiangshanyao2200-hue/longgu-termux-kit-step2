# UI 复杂小修（执行计划）

目标：在不扩大功能面的前提下，清理无用分支、提升可读性/稳定性，并修复交互细节（尤其是“思考/选择/设置”）。

## 范围
- 仅改 `AItermux/system`（TUI 逻辑 + 渲染）。
- 不引入新的弹窗体系；继续沿用“聊天流内动态层 + 详情/简约形态切换”。

## 任务清单（按执行顺序）
1. （已完成 2026-02-04）移除 `/Think MCP` 相关能力
   - 删除 `/think mcp open/close` 命令与未知命令提示中的对应条目
   - 删除系统配置 `think_mcp_enabled`、设置项与相关 UI
   - 删除“从 thinking 中兜底解析/执行 MCP 工具”的逻辑（thinking 永远视为纯文本）

2. （已完成 2026-02-04）设置/聊天选中高亮修复（可读性优先）
   - 取消 `REVERSED` 反色高亮，改用稳定的背景色（避免遮挡字体/反色不可控）
   - 设置页签/字段、聊天选中行统一使用同一套选中样式

3. （已完成 2026-02-04）“Trun dog” 文案与命令升级
   - 增加新命令别名：`/switch main`、`/switch memory`
   - 旧命令 `/turn`、`/trun` 继续兼容（main/dog/memory 都接受）
   - 命令菜单与提示文案改为：`Switch model (Main/Memory)`

4. （已完成 2026-02-04）系统配置项裁剪与重命名
   - 移除“动效开关”（默认全开，后期再加）
   - “心跳”改为“心跳时间间隔”，并支持 `0=关闭`
   - “压缩阈值”改为“动态上下文阈值”
   - “上下文”改为“上下文压缩阈值”

5. （已完成 2026-02-04）设置页状态栏信息增强
   - 随着 ↑↓ 切换字段，底部状态栏实时显示对应简短提示（而不是固定“设置导航/配置浏览”）
   - 状态栏左侧缩进统一（从 2 空格 → 1 空格）

6. （已完成 2026-02-04）输入横杠动画加速
   - 提高输入态“光标”移动速度，减少等待感
   - 保持系统活跃时的“中间呼吸”动画，避免蓝色跑马/色彩冲突

7. （已完成 2026-02-04）Context Bar 文案精简
   - 按约定改为：`Ctx ..% Date ..% ↑..M ↓..M T↑..M T↓..M ♡.. ♥..`

8. （已完成 2026-02-04，后续调整 2026-02-04）思考（think）展示规则
   - 流式时：只在 `running` 阶段显示思考（不再斜体）
   - 思考结束（正文开始）立即隐藏：取消“5s 停留/折叠收敛动画”
   - 非流式：简约模式不显示思考；Tab 切到详情模式才回看最近思考

9. （已完成 2026-02-04）选择模式与滚动闭环
   - 禁止 `↓` 在“未选中任何消息”时进入选择（避免从头选择导致跳顶）
   - 仅允许 `↑` 在空输入时进入选择（从底部向上选）
   - 选择移动时自动滚动，保证选中消息始终可见（与手势滚动更契合）

10. （已完成 2026-02-04）缩放/重排不重播乱码
   - `Resize`/宽度变化时不再清空“乱码动效缓存”，避免整屏消息重播动画干扰阅读/造成卡顿

11. （已完成 2026-02-04）输入状态栏递增点号
   - 仅对“API 活跃相关”状态提示追加 `.`→`..`→`...` 循环（降低延迟感）
   - `Ready` / 菜单说明 / Settings 引导提示不参与（避免眼花）

12. （已完成 2026-02-04）多条展开 + 详情尽量不截断
   - `←/→` 展开改为“可同时展开多条”（集合保存展开状态，而不是单一 idx）
   - 工具详情展示默认不截断（保留极高安全阈值，避免异常超大输出拖垮 TUI）

## 验收点（最小回归）
- `/think` 相关功能完全消失：无命令、无设置项、不会从 thinking 执行工具
- Settings：上下移动字段时，底部提示能正确更新，且选中高亮不遮挡文字
- Chat：空输入时 `↑` 进入选择、`↓` 不会跳到顶部；选择移动会自动滚动
- SSE 流式：思考与正文都能“动态显示”；思考结束（正文开始）立即隐藏（不再 5s 停留/折叠）
- 非流式：简约模式不显示思考；仅在详情模式回看
- `cargo test` / `cargo build` 通过

## 元反思（风险）
- 主要风险在“选择自动滚动”：需要基于渲染后的行号映射，避免靠估算引入新错位。
- 主要风险在“详情不截断”：工具输出可能非常大，必须保留极高的安全阈值（防止卡顿/爆内存）。
- 主要风险在“多条展开”：历史 prune/删除消息时需要同步更新索引，避免展开集合指向错误消息。
