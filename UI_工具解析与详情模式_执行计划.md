# UI 工具解析与“详情模式”（执行计划）

目标：在不引入弹窗的前提下，让工具信息在手机小屏上**默认极简、必要时一键展开**；并在大量历史消息时避免卡顿/闪退。

---

## 1) 交互规格（本轮冻结）

### 1.1 形态切换
- `Tab`：切换 **简约模式 / 详情模式（全局）**
  - 简约：工具只显示一行摘要（工具类型 + brief）
  - 详情：工具展示“解析后的详情”（路径/命令/输入输出截断等），但做渲染上限防卡顿
- `Home`：退出“选择消息”状态（取消高亮）

### 1.2 局部展开（仍保留）
- `↑/↓`：选择消息（输入框为空时）
- `←`：对选中的 AI 正文，展开/收起思考（固定/取消固定）
- `→`：对选中的工具消息，展开/收起工具详情

---

## 2) 工具展示规格（两套解析）

### 2.1 简约模式（默认）
- 一行：`● <工具类型> · <brief>`
  - 示例：`● Ran CMD · ...`、`● Worked with ADB · ...`、`● Edited · ...`
  - 规则：工具名（如 `ADB/CMD/Edit`）高亮黄色，其余保持正常亮度；brief 不高亮。
  - 若失败：尾部追加 `（失败）` 轻提示。

### 2.2 详情模式（全局 or `→`）
- 顶部：解析后的头部（工具名 + 简约目标，如短路径/文件名/+/- 变更量）
- 次行：斜体 `↳ <brief>`（若有）
- 内容：按工具类型展示
  - 文件类：展示短路径 + diff/patch（截断，保留开头与结尾）
  - 命令类：命令做中间省略，输出保留开头/结尾
  - 其它：沿用 output/meta 分区，但排版更紧凑

---

## 3) 性能保护（必须）
- `Tab` 切换做防抖（例如 250ms 内忽略重复切换）
- 详情模式渲染上限：仅“深度解析”最近 N 条（例如 120 条），更早消息仍按简约渲染；切换时在 sys_log 提示该上限

---

## 4) 验收
- `cargo fmt && cargo test && ./selfcheck.sh`
- 快捷键文档更新（README + 计划文档同步）
- 大量历史时 `Tab` 不会卡死/闪退（至少通过软上限与防抖保证）

